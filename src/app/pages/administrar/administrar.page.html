<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Administrar Usuarios</ion-title>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <div class="text-center">
    <h3 class="ion-text-center"><strong>Administración de Usuarios</strong></h3>
  </div>

  <ion-card class="custom-card">
    <form [formGroup]="personaForm" (ngSubmit)="registrar()">
      <ion-input formControlName="rut" type="text" labelPlacement="stacked" label="RUT" fill="outline"></ion-input>
      <ion-input formControlName="usuario" type="text" labelPlacement="stacked" label="Usuario" fill="outline"></ion-input>
      <ion-input formControlName="email" type="email" labelPlacement="stacked" label="Email" fill="outline"></ion-input>
      <div *ngIf="personaForm.errors?.['passwordMismatch']" class="error-message">
        Las contraseñas no coinciden.
      </div>
      <ion-input formControlName="contrasena" type="password" labelPlacement="stacked" label="Contraseña" fill="outline"></ion-input>
      <ion-input formControlName="contrasena_conf" type="password" labelPlacement="stacked" label="Confirme la Contraseña" fill="outline"></ion-input>
      <ion-input formControlName="fecha_nacimiento" type="date" labelPlacement="stacked" label="Fecha nacimiento" fill="outline"></ion-input>
      <div *ngIf="personaForm.get('fecha_nacimiento')?.errors?.['edadInvalida']" class="error-message">
        Debes tener al menos 18 años.
      </div>

      <ion-item>
        <ion-label>¿Tiene vehículo?</ion-label>
        <ion-checkbox formControlName="tieneVehiculo" (ionChange)="toggleFormulario()"></ion-checkbox>
      </ion-item>

      <div *ngIf="personaForm.get('tieneVehiculo')?.value">
        <ion-card class="vehicle-card">
          <ion-input formControlName="patente" type="text" labelPlacement="stacked" label="Patente" fill="outline"></ion-input>
          <ion-input formControlName="marca" type="text" labelPlacement="stacked" label="Marca del auto" fill="outline"></ion-input>
          <ion-input formControlName="modelo" type="text" labelPlacement="stacked" label="Modelo del auto" fill="outline"></ion-input>
          <ion-input formControlName="color" type="text" labelPlacement="stacked" label="Color del auto" fill="outline"></ion-input>
        </ion-card>
      </div>

      <div *ngIf="!editar">
        <ion-button [disabled]="personaForm.invalid" type="submit" expand="full" color="secondary">REGISTRAR</ion-button>
      </div>

      <div *ngIf="editar">
        <ion-button (click)="modificar()" expand="full" color="dark">Editar</ion-button>
      </div>
      <ion-button (click)="limpiar()" expand="full" color="secondary">LIMPIAR</ion-button>
    </form>
  </ion-card>

  <ion-list *ngFor="let usuario of usuarios">
    <ion-item-sliding>
      <ion-item-options side="start">
        <ion-item-option (click)="buscar(usuario.rut)" color="warning">Editar</ion-item-option>
      </ion-item-options>

      <ion-item>{{usuario.rut}} - {{usuario.usuario}}</ion-item>

      <ion-item-options side="end">
        <ion-item-option (click)="eliminar(usuario.rut)" color="danger">Eliminar</ion-item-option>
      </ion-item-options>
    </ion-item-sliding>
  </ion-list>

</ion-content>
